# CP02电源监控项目

## 项目概述
这是一个基于ESP32-C6开发的电源监控系统，主要用于实时监控和显示多个USB-C端口的供电状态。项目集成了WiFi配置、电源监控、RGB指示灯和LCD显示等功能模块。

## 硬件组成
1. 主控制器：ESP32-C6（单核处理器）
2. 显示屏：ST7789驱动的LCD屏幕
3. RGB指示灯
4. USB-C端口：5个监控端口（A1, C1, C2, C3, C4）

## 软件架构

### 1. 配置管理模块（Config_Manager）
- 负责WiFi网络配置
- 提供Web配置界面
- 管理系统参数存储
- 特点：
  - 支持AP模式配置
  - 配置数据持久化存储
  - 支持配置重置功能
  - WiFi连接状态管理

### 2. 显示管理模块（Display_Manager）
- 管理不同显示界面的切换
- 包含三个主要界面：
  - AP配置界面
  - 监控界面
  - WiFi错误界面
- 使用LVGL图形库实现UI

### 3. 电源监控模块（Power_Monitor）
- 实时监控各端口电源状态
- 功能特点：
  - 支持5个端口独立监控
  - 显示电压、电流、功率数据
  - 总功率计算和显示
  - 进度条显示功率使用情况
  - 异常状态提示

### 4. RGB指示灯模块（RGB_Lamp）
- 提供视觉反馈
- 可通过配置界面开启/关闭
- 支持动态效果

## 主要功能

### 1. WiFi配置功能
- 首次使用自动进入AP模式
- Web配置界面（http://设备IP）
- 支持：
  - WiFi网络设置
  - 监控服务器配置
  - RGB灯控制
  - 系统重置

### 2. 电源监控功能
- 实时监控参数：
  - 各端口电压
  - 各端口电流
  - 各端口功率
  - 总功率
- 安全限制：
  - 单端口最大功率：140W
  - 总功率上限：160W

### 3. 显示功能
- 实时数据显示
- 进度条可视化
- WiFi状态指示
- 异常状态提示

## 工作流程

### 1. 系统启动
- 初始化显示
- 检查配置状态
- 启动必要服务

### 2. 正常工作模式
- 连接WiFi网络
- 获取电源数据
- 更新显示界面
- 控制RGB指示

### 3. 配置模式
- 启动AP热点
- 提供Web配置界面
- 保存新配置
- 重启进入工作模式

## 异常处理

### 1. WiFi断开处理
- 显示错误界面
- 自动重连
- 状态指示

### 2. 数据异常处理
- 显示错误提示
- 继续尝试获取数据
- 保持界面响应

## 优化特点

### 1. 单任务设计
- 适应ESP32-C6单核特性
- 优化资源利用
- 提高系统稳定性

### 2. 界面优化
- 紧凑布局设计
- 直观的数据展示
- 清晰的状态反馈

### 3. 稳定性保障
- 看门狗保护
- 异常自动恢复
- 配置持久化

## 注意事项

### 1. 配置相关
- 首次使用需要配置WiFi
- 记录配置参数
- 可随时重置配置

### 2. 使用限制
- 注意功率限制
- 确保WiFi信号稳定
- 定期检查连接状态

### 3. 维护建议
- 定期检查系统状态
- 保持固件更新
- 注意环境温度

## 开发环境
- 开发平台：Arduino IDE
- 主要依赖：
  - LVGL图形库
  - ESP32 Arduino核心库
  - WiFi库
  - WebServer库
  - DNSServer库
  - Preferences库

## 许可证
本项目采用MIT许可证。详细信息请参见LICENSE文件。

## 贡献
欢迎提交问题报告和改进建议。如果您想为项目做出贡献，请遵循以下步骤：
1. Fork本仓库
2. 创建您的特性分支
3. 提交您的改动
4. 推送到您的分支
5. 创建Pull Request

## 联系方式
如有问题或建议，请通过以下方式联系：
- 提交Issue
- 发送邮件至：[您的邮箱地址]

## 更新日志
- V1.9 (2024-05-17)
  - 新增功能：
    - 实现自动设备发现功能，支持自动扫描局域网中的 metrics 服务器
    - 添加专门的扫描界面，优化用户体验
    - 实现自动设备发现和监控 URL 更新
  - 界面优化：
    - 新增扫描界面，使用大号字体（标题24号，状态20号）
    - 优化状态显示和布局设计
    - 添加详细的扫描状态提示
  - 代码改进：
    - 重构设备发现相关代码，提高可维护性
    - 优化任务处理逻辑
    - 完善错误处理机制
  - 移除：
    - 删除独立的 Device_Discovery 模块，功能整合到 Network_Scanner 类

- V1.8 (2024-05-02)
  - 初始版本发布
  - 实现基本功能
  - 优化显示界面
  - 添加配置功能 